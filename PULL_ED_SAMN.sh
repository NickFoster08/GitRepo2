#!/bin/bash
#SBATCH --job-name=MEX_USA_Animal_Bov      # Job name
#SBATCH --partition=batch                # Partition (queue) name
#SBATCH --ntasks=1                       # Run on a single CPU
#SBATCH --cpus-per-task=8                # Number of cores per task
#SBATCH --mem=80gb                       # Job memory request
#SBATCH --time=00-24:00:00               # Time limit hrs:min:sec
#SBATCH --output=/scratch/nf26742/scratch/log.%j.out  # Standard output log
#SBATCH --error=/scratch/nf26742/scratch/log.%j.err   # Standard error log

#SBATCH --mail-type=END,FAIL             # Mail events (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --mail-user=nf26742@uga.edu      # Where to send mail

# Output directories
OUTDIR="/scratch/nf26742/Mex_USA_Animal_Bovis"
TMPDIR="/scratch/nf26742/tmp"
mkdir -p "$OUTDIR" "$TMPDIR"

# Load required modules
module load SRA-Toolkit/3.0.3-gompi-2022a
module load EDirect/11.20.20220822

# Set TMPDIR for SRA Toolkit
export TMPDIR="$TMPDIR"

# List of SAMN or SRX accessions
ids=(SAMN03300815
SAMN14336426
SAMN14336428
SAMN14336433
SAMN14336435
SAMN14336436
SAMN14336440
SAMN14336441
SAMN14336443
SAMN14336447
SAMN14336450
SAMN14336451
SAMN14336421
SAMN14336431
SAMN14336418
SAMN14336422
SAMN14336425
SAMN14336429
SAMN14336432
SAMN14336434
SAMN14336438
SAMN14336442
SAMN14336448
SAMN14336419
SAMN14336420
SAMN14336423
SAMN14336424
SAMN14336427
SAMN14336430
SAMN14336437
SAMN14336439
SAMN14336444
SAMN14336445
SAMN14336446
SAMN14336449
SAMN03300688
SAMN03300689
SAMN03300692
SAMN03300697
SAMN03300711
SAMN03300721
SAMN03300724
SAMN03300730
SAMN03300601
SAMN03300607
SAMN03300610
SAMN03300613
SAMN03300619
SAMN03300623
SAMN03300632
SAMN03300639
SAMN03300641
SAMN03300644
SAMN03300651
SAMN03300652
SAMN03300654
SAMN03300660
SAMN03300664
SAMN03300669
SAMN03300671
SAMN03300674
SAMN03300676
SAMN03300677
SAMN03300679
SAMN03300691
SAMN03300695
SAMN03300698
SAMN03300709
SAMN03300715
SAMN03300726
SAMN03300731
SAMN03300734
SAMN03300737
SAMN03300745
SAMN03300750
SAMN03300753
SAMN03300761
SAMN03300763
SAMN03300772
SAMN03300773
SAMN03300776
SAMN03300794
SAMN03300796
SAMN03300799
SAMN03300804
SAMN03300614
SAMN03300685
SAMN03300631
SAMN03300633
SAMN03300636
SAMN03300825
SAMN03300826
SAMN03300822
SAMN04386735
SAMN04386737
SAMN04386736
SAMN04386742
SAMN03300791
SAMN03300797
SAMN03300800
SAMN03300801
SAMN03300803
SAMN03300809
SAMN03300771
SAMN03300775
SAMN03300780
SAMN03300792
SAMN03300795
SAMN03300798
SAMN03300807
SAMN03300808
SAMN03300823
SAMN03300827
SAMN03300828
SAMN03300829
SAMN04386731
SAMN04386743
SAMN04386745
SAMN03300604
SAMN03300605
SAMN03300608
SAMN03300609
SAMN03300611
SAMN03300612
SAMN03300615
SAMN03300616
SAMN03300663
SAMN03300665
SAMN03300670
SAMN03300672
SAMN03300678
SAMN03300680
SAMN03300686
SAMN03300687
SAMN03300699
SAMN03300700
SAMN03300701
SAMN03300705
SAMN03300707
SAMN03300805
SAMN03300813
SAMN03300816
SAMN03300618
SAMN03300630
SAMN03300647
SAMN03300653
SAMN03300659
SAMN04386732
SAMN04386738
SAMN04386744
SAMN04386749
SAMN03300624
SAMN03300625
SAMN03300626
SAMN03300628
SAMN03300629
SAMN03300642
SAMN03300648
SAMN03300649
SAMN03300650
SAMN03300656
SAMN03300658
SAMN03300706
SAMN03300710
SAMN03300713
SAMN03300717
SAMN03300719
SAMN03300720
SAMN03300722
SAMN03300728
SAMN03300733
SAMN03300735
SAMN03300736
SAMN03300741
SAMN03300744
SAMN03300748
SAMN03300752
SAMN03300754
SAMN03300755
SAMN03300757
SAMN03300759
SAMN03300760
SAMN03300765
SAMN03300767
SAMN03300769
SAMN04386733
SAMN04386739
SAMN04386741
SAMN04386746
SAMN03300603
SAMN03300634
SAMN03300637
SAMN03300725
SAMN03300732
SAMN03300738
SAMN03300739
SAMN03300742
SAMN03300747
SAMN03300749
SAMN03300770
SAMN03300774
SAMN03300777
SAMN03300778
SAMN03300787
SAMN03300802
SAMN03300806
SAMN03300814
SAMN04386734
SAMN04386740
SAMN04386747
SAMN04386748
SAMN04386750
SAMN04386751
SAMN03300640
SAMN03300643
SAMN03300646
SAMN03300655
SAMN03300667
SAMN03300668
SAMN03300673
SAMN03300675
SAMN03300702
SAMN03300703
SAMN03300712
SAMN03300714
SAMN03300683
SAMN03300684
SAMN03300690
SAMN03300696
SAMN03300716
SAMN03300718
SAMN03300723
SAMN03300727
SAMN03300729
SAMN03300743
SAMN03300746
SAMN03300751
SAMN03300756
SAMN03300758
SAMN03300762
SAMN03300764
SAMN03300766
SAMN03300768
SAMN06855950
SAMN06855961
SAMN06855969
SAMN06855982
SAMN06855993
SAMN06856003
SAMN06244382
SAMN06244392
SAMN06672761
SAMN06672762
SAMN06672766
SAMN06672777
SAMN06672780
SAMN06672783
SAMN06672794
SAMN06672798
SAMN06672799
SAMN06672810
SAMN06672817
SAMN06672821
SAMN06672824
SAMN06672830
SAMN06672832
SAMN06672834
SAMN06672841
SAMN06672842
SAMN06672843
SAMN06672847
SAMN06672851
SAMN06672853
SAMN06672854
SAMN06672856
SAMN06672863
SAMN06672866
SAMN06672868
SAMN06672876
SAMN06855920
SAMN06855930
SAMN06855932
SAMN06855938
SAMN06855939
SAMN06855948
SAMN06855952
SAMN06855960
SAMN06855967
SAMN06855970
SAMN06855973
SAMN06855975
SAMN06855987
SAMN06855990
SAMN06855991
SAMN06672734
SAMN06672744
SAMN06672749
SAMN06672750
SAMN06672757
SAMN06855916
SAMN06855917
SAMN06855921
SAMN06855922
SAMN06855924
SAMN06855925
SAMN06855927
SAMN06855928
SAMN06855931
SAMN06855933
SAMN06855937
SAMN06855942
SAMN06855949
SAMN06855955
SAMN06855958
SAMN06855962
SAMN06855971
SAMN06855974
SAMN06855978
SAMN06855988
SAMN06855992
SAMN06244245
SAMN06244260
SAMN06244278
SAMN06244297
SAMN06244306
SAMN06244360
SAMN06244377
SAMN06244336
SAMN06244337
SAMN06244340
SAMN06244341
SAMN06855940
SAMN06855944
SAMN06855957
SAMN06855959
SAMN06855964
SAMN06855965
SAMN06855998
SAMN06856001
SAMN06856020
SAMN06856058
SAMN06856059
SAMN06856068
SAMN06244259
SAMN06244262
SAMN06244288
SAMN06244289
SAMN06244302
SAMN06244321
SAMN06244324
SAMN06244332
SAMN06244334
SAMN06244339
SAMN06856013
SAMN06856014
SAMN06856016
SAMN06856021
SAMN06856022
SAMN06856026
SAMN06856033
SAMN06856037
SAMN06856040
SAMN06856041
SAMN06856042
SAMN06856043
SAMN06856044
SAMN06856049
SAMN06856051
SAMN06856052
SAMN06244347
SAMN06244348
SAMN06244353
SAMN06244363
SAMN06244366
SAMN06244375
SAMN06672770
SAMN06672771
SAMN06672775
SAMN06672776
SAMN06672781
SAMN06672784
SAMN06855926
SAMN06855929
SAMN06855935
SAMN06855936
SAMN06855941
SAMN06855945
SAMN06855946
SAMN06855947
SAMN06855951
SAMN06855954
SAMN06855956
SAMN06855963
SAMN06855966
SAMN06672751
SAMN06672773
SAMN06672788
SAMN06672789
SAMN06672790
SAMN06672795
SAMN06672796
SAMN06672801
SAMN06672808
SAMN06672809
SAMN06672732
SAMN06672735
SAMN06672739
SAMN06672741
SAMN06855923
SAMN06855943
SAMN06855953
SAMN06855986
SAMN06672859
SAMN06672860
SAMN06672870
SAMN06672871
SAMN06672873
SAMN06672885
SAMN06856046
SAMN06672745
SAMN06672753
SAMN06672754
SAMN06672755
SAMN06672760
SAMN06672797
SAMN06672802
SAMN06672807
SAMN06672814
SAMN06672818
SAMN06672819
SAMN06672827
SAMN06672829
SAMN06672838
SAMN06672844
SAMN06672849
SAMN06672850
SAMN06672852
SAMN06672855
SAMN06672858
SAMN06672861
SAMN06672875
SAMN06672877
SAMN06244240
SAMN06244241
SAMN06244244
SAMN06244246
SAMN06244253
SAMN06244258
SAMN06855968
SAMN06855976
SAMN06855977
SAMN06855979
SAMN06855981
SAMN06855985
SAMN06855995
SAMN06855997
SAMN06855999
SAMN06856007
SAMN06856012
SAMN06856053
SAMN06856054
SAMN06856055
SAMN06856056
SAMN06856057
SAMN06856061
SAMN06856062
SAMN06856063
SAMN06856065
SAMN06856066
SAMN06856067
SAMN06244248
SAMN06244250
SAMN06244251
SAMN06244263
SAMN06244267
SAMN06244268
SAMN06244273
SAMN06244275
SAMN06244285
SAMN06244287
SAMN06244291
SAMN06244292
SAMN06244296
SAMN06244299
SAMN06244301
SAMN06244303
SAMN06244309
SAMN06244319
SAMN06672733
SAMN41074465
SAMN06244308
SAMN06244310
SAMN06244311
SAMN06244315
SAMN06244316
SAMN06244320
SAMN06244323
SAMN06244325
SAMN06244326
SAMN06244327
SAMN06244329
SAMN06244333
SAMN06244342
SAMN06244343
SAMN06244344
SAMN06244345
SAMN06244346
SAMN06855934
SAMN06856006
SAMN06856015
SAMN06856028
SAMN06856038
SAMN06856047
SAMN06856064
SAMN06244279
SAMN06244282
SAMN06244284
SAMN06244293
SAMN06244294
SAMN06244295
SAMN06244298
SAMN06244300
SAMN06244349
SAMN06244356
SAMN06244359
SAMN06244364
SAMN06244367
SAMN06244369
SAMN06244370
SAMN06244373
SAMN06244376
SAMN06244378
SAMN06244385
SAMN06244388
SAMN06672736
SAMN06672737
SAMN41074466
SAMN41074471
SAMN06244261
SAMN06244264
SAMN06244265
SAMN06244266
SAMN06244269
SAMN06244270
SAMN06244271
SAMN06244272
SAMN06244274
SAMN06244276
SAMN06244277
SAMN06244280
SAMN06244281
SAMN06244283
SAMN06244286
SAMN06244290
SAMN06244304
SAMN06244305
SAMN06244307
SAMN06244312
SAMN06244313
SAMN06244314
SAMN06244335
SAMN06244351
SAMN06244358
SAMN06244361
SAMN06244317
SAMN06244318
SAMN06244322
SAMN06244328
SAMN06244330
SAMN06244331
SAMN06244338
SAMN06244352
SAMN06244357
SAMN06244362
SAMN06244365
SAMN06244368
SAMN06244379
SAMN06244383
SAMN06244384
SAMN06244390
SAMN06244393
SAMN06672874
SAMN06672881
SAMN06672883
SAMN06244252
SAMN06856004
SAMN06856005
SAMN06856008
SAMN06856024
SAMN06856025
SAMN06856027
SAMN06856030
SAMN06856031
SAMN06856036
SAMN06856045
SAMN06856060
SAMN06856069
SAMN06856070
SAMN06672845
SAMN06672846
SAMN06672848
SAMN06672857
SAMN06672862
SAMN06672864
SAMN06672865
SAMN06672867
SAMN06672869
SAMN06672872
SAMN06672878
SAMN06672880
SAMN06672882
SAMN06244239
SAMN06244255
SAMN06244256
SAMN06244257
SAMN06672740
SAMN06672742
SAMN06672743
SAMN06672746
SAMN06672748
SAMN06672752
SAMN06672756
SAMN06672758
SAMN06672764
SAMN06672767
SAMN06672768
SAMN06672769
SAMN06672779
SAMN06672782
SAMN06672786
SAMN06672791
SAMN06672792
SAMN06672793
SAMN06672800
SAMN06672803
SAMN06672804
SAMN06672805
SAMN06672806
SAMN06672811
SAMN06672812
SAMN06672813
SAMN06672815
SAMN06672816
SAMN06672820
SAMN06672822
SAMN06672823
SAMN06672826
SAMN06244371
SAMN06244380
SAMN06244381
SAMN06244387
SAMN06244389
SAMN06672828
SAMN06672831
SAMN06672833
SAMN06672835
SAMN06244350
SAMN06244354
SAMN06244355
SAMN06244372
SAMN06244374
SAMN06244386
SAMN06244391
SAMN06855918
SAMN06855919
SAMN06244242
SAMN06244243
SAMN06244247
SAMN06244249
SAMN06244254
SAMN06855972
SAMN06855980
SAMN06855983
SAMN06855984
SAMN06855989
SAMN06855994
SAMN06855996
SAMN06856000
SAMN06856002
SAMN06856009
SAMN06856010
SAMN06856011
SAMN06856017
SAMN06856018
SAMN06856019
SAMN06856023
SAMN06856029
SAMN06856032
SAMN06856034
SAMN06856035
SAMN06856039
SAMN06856048
SAMN06856050
SAMN41074464
SAMN06672738
SAMN06672747
SAMN06672759
SAMN06672763
SAMN06672765
SAMN06672772
SAMN06672774
SAMN06672778
SAMN06672785
SAMN06672787
SAMN06672825
SAMN06672836
SAMN06672837
SAMN06672839
SAMN06672840
SAMN06672879
SAMN06672884
SAMN18264921
SAMN03300740
SAMN03300602
SAMN03300693
SAMN03300620
SAMN03300781
SAMN04386729
SAMN04386755
SAMN04386730
SAMN18823542
SAMN18823545
SAMN18823543
SAMN18823544
SAMN18823547
SAMN18823548
SAMN18823546
SAMN18823585
SAMN18823614
SAMN18823633
SAMN18823640
SAMN18823641
SAMN18823645
SAMN18823646
SAMN18823651
SAMN18823550
SAMN18823551
SAMN18823557
SAMN18823558
SAMN18823560
SAMN18823566
SAMN18823570
SAMN18823571
SAMN18823572
SAMN18823577
SAMN18823578
SAMN18823581
SAMN18823582
SAMN18823587
SAMN18823588
SAMN18823589
SAMN18823596
SAMN18823598
SAMN18823599
SAMN18823602
SAMN18823603
SAMN18823618
SAMN18823621
SAMN18823625
SAMN18823632
SAMN18823636
SAMN18823644
SAMN18823656
SAMN18823663
SAMN18823668
SAMN18823669
SAMN18823671
SAMN18823672
SAMN18823677
SAMN18823684
SAMN18823686
SAMN18823696
SAMN18823716
SAMN18823549
SAMN18823552
SAMN18823556
SAMN18823559
SAMN18823565
SAMN18823567
SAMN18823568
SAMN18823580
SAMN18823584
SAMN18823591
SAMN18823592
SAMN18823595
SAMN18823597
SAMN18823607
SAMN18823675
SAMN18823683
SAMN18823689
SAMN18823699
SAMN18823709
SAMN18823712
SAMN18823713
SAMN18823718
SAMN18823719
SAMN18823781
SAMN18823785
SAMN18823786
SAMN18823787
SAMN18823789
SAMN18823790
SAMN18823797
SAMN18823798
SAMN18823806
SAMN18823807
SAMN18823809
SAMN18823812
SAMN18823815
SAMN18823817
SAMN18823820
SAMN18823821
SAMN18823827
SAMN18823830
SAMN18823835
SAMN18823840
SAMN18823842
SAMN18823843
SAMN18823850
SAMN18823851
SAMN18823853
SAMN18823854
SAMN18823857
SAMN18823862
SAMN18823864
SAMN18823563
SAMN18823569
SAMN18823604
SAMN18823623
SAMN18823775
SAMN18823792
SAMN18823801
SAMN18823811
SAMN18823819
SAMN18823826
SAMN18823829
SAMN18823832
SAMN18823836
SAMN18823839
SAMN18823855
SAMN18823861
SAMN18823654
SAMN18823657
SAMN18823658
SAMN18823659
SAMN18823660
SAMN18823661
SAMN18823662
SAMN18823666
SAMN18823678
SAMN18823682
SAMN18823687
SAMN18823691
SAMN18823698
SAMN18823703
SAMN18823733
SAMN18823767
SAMN18823768
SAMN18823780
SAMN18823782
SAMN18823783
SAMN18823784
SAMN18823793
SAMN18823794
SAMN18823796
SAMN18823802
SAMN18823804
SAMN18823808
SAMN18823810
SAMN18823814
SAMN18823818
SAMN18823824
SAMN18823883
SAMN18823608
SAMN18823609
SAMN18823610
SAMN18823611
SAMN18823627
SAMN18823628
SAMN18823635
SAMN18823647
SAMN18823650
SAMN18823655
SAMN18823664
SAMN18823665
SAMN18823679
SAMN18823680
SAMN18823681
SAMN18823688
SAMN18823693
SAMN18823697
SAMN18823701
SAMN18823705
SAMN18823711
SAMN18823715
SAMN18823866
SAMN18823872
SAMN18823728
SAMN18823729
SAMN18823730
SAMN18823732
SAMN18823770
SAMN18823771
SAMN18823772
SAMN18823776
SAMN18823777
SAMN18823778
SAMN18823791
SAMN18823795
SAMN18823799
SAMN18823800
SAMN18823803
SAMN18823805
SAMN18823813
SAMN18823816
SAMN18823822
SAMN18823823
SAMN18823554
SAMN18823704
SAMN18823706
SAMN18823708
SAMN18823717
SAMN18823721
SAMN18823722
SAMN18823734
SAMN18823739
SAMN18823748
SAMN18823749
SAMN18823750
SAMN18823755
SAMN18823760
SAMN18823761
SAMN18823765
SAMN18823766
SAMN18823676
SAMN18823692
SAMN18823694
SAMN18823702
SAMN18823707
SAMN18823710
SAMN18823714
SAMN18823720
SAMN18823726
SAMN18823834
SAMN18823837
SAMN18823838
SAMN18823845
SAMN18823846
SAMN18823849
SAMN18823859
SAMN18823860
SAMN18823867
SAMN18823868
SAMN18823869
SAMN18823871
SAMN18823873
SAMN18823875
SAMN18823877
SAMN18823881
SAMN18823731
SAMN18823736
SAMN18823738
SAMN18823740
SAMN18823742
SAMN18823745
SAMN18823753
SAMN18823754
SAMN18823756
SAMN18823759
SAMN18823762
SAMN18823764
SAMN18823882
SAMN18823652
SAMN18823685
SAMN18823690
SAMN18823695
SAMN18823700
SAMN18823833
SAMN18823841
SAMN18823844
SAMN18823847
SAMN18823848
SAMN18823852
SAMN18823856
SAMN18823858
SAMN18823863
SAMN18823865
SAMN18823870
SAMN18823876
SAMN18823878
SAMN18823879
SAMN18823880
SAMN18823884
SAMN18823885
SAMN18823553
SAMN18823555
SAMN18823561
SAMN18823562
SAMN18823564
SAMN18823573
SAMN18823574
SAMN18823575
SAMN18823576
SAMN18823579
SAMN18823583
SAMN18823586
SAMN18823590
SAMN18823594
SAMN18823601
SAMN18823605
SAMN18823606
SAMN18823612
SAMN18823615
SAMN18823616
SAMN18823617
SAMN18823619
SAMN18823620
SAMN18823622
SAMN18823624
SAMN18823626
SAMN18823629
SAMN18823631
SAMN18823634
SAMN18823637
SAMN18823638
SAMN18823639
SAMN18823642
SAMN18823648
SAMN18823649
SAMN18823779
SAMN18823788
SAMN18823825
SAMN18823828
SAMN18823831
SAMN18823593
SAMN18823600
SAMN18823751
SAMN18823752
SAMN18823757
SAMN18823723
SAMN18823724
SAMN18823725
SAMN18823727
SAMN18823735
SAMN18823737
SAMN18823741
SAMN18823743
SAMN18823744
SAMN18823746
SAMN18823747
SAMN18823758
SAMN18823763
SAMN18823769
SAMN18823773
SAMN18823774
SAMN18823874
SAMN18823613
SAMN18823630
SAMN18823643
SAMN18823653
SAMN18823667
SAMN18823670
SAMN18823673
SAMN18823674
SAMN03300708
SAMN03300818
SAMN03300819
SAMN03300817
SAMN03300820
SAMN03300821
SAMN03300824
SAMEA120581581
SAMN03300681
SAMN03300786
SAMN03300682
SAMN03300785
SAMN03300788
SAMN03300811
SAMN03300782
SAMN03300783
SAMN03300784
SAMN03300789
SAMN03300810
SAMN03300812
)

for id in "${ids[@]}"; do
    echo "üîç Resolving SRRs for $id"

    # Get SRR accessions
    srrs=$(esearch -db sra -query "$id" | efetch -format runinfo | cut -d',' -f1 | tail -n +2)

    if [ -z "$srrs" ]; then
        echo "‚ö†Ô∏è No SRRs found for $id, skipping..."
        continue
    fi

    for srr in $srrs; do
        echo "üì• Prefetching $srr"
        prefetch "$srr" -O "$OUTDIR"
        if [[ $? -ne 0 ]]; then
            echo "‚ö†Ô∏è Prefetch failed for $srr, skipping..."
            continue
        fi

        # Full path to the downloaded .sra
        SRA_FILE="$OUTDIR/$srr/$srr.sra"

        echo "üîÑ Converting $srr.sra to FASTQ"
        fasterq-dump "$SRA_FILE" -O "$OUTDIR" --threads 8
        if [[ $? -eq 0 ]]; then
            echo "‚úÖ Successfully downloaded and converted $srr"
        else
            echo "‚ö†Ô∏è Failed to convert $srr"
        fi
    done
done